# 协议

## DNS

DNS（Domain Name System）域名系统是互联网的一项服务。它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。DNS使用TCP和UDP端口53。当前，对于每一级域名长度的限制是63个字符，域名总长度则不能超过253个字符。

### 记录类型

DNS系统中，常见的资源记录类型有：

1. 主机记录（A记录）

    RFC 1035定义，A记录是用于名称解析的重要记录，它将特定的主机名映射到对应主机的IP地址上。

2. 别名记录（CNAME记录）

    RFC 1035定义，CNAME记录用于将某个别名指向到某个A记录上，这样就不需要再为某个新名字另外创建一条新的A记录。

3. IPv6主机记录（AAAA记录）

   RFC 3596定义，与A记录对应，用于将特定的主机名映射到一个主机的IPv6地址。

4. 服务位置记录（SRV记录）

   RFC 2782定义，用于定义提供特定服务的服务器的位置，如主机（hostname），端口（port number）等。

5. NAPTR记录

    RFC 3403定义，它提供了正则表达式方式去映射一个域名。NAPTR记录非常著名的一个应用是用于ENUM查询。

6. MX记录

    RFC 1035定义，它提供域名到邮件传输代理（MTA）之间的映射关系。

7. PRT记录

    Point Record。记录IP到域名的映射。与A或AAAA记录相反。
    

# DHCP

动态主机设置协议（Dynamic Host Configuration Protocol）是一个局域网的网络协议，使用UDP协议工作，主要有两个用途：

1. 用于内部网或网络服务供应商自动分配IP地址给用户
2. 用于内部网管理员作为对所有计算机作中央管理的手段

DHCP由服务端和客户端组成。客户端发送请求，使用68/UDP，服务端响应请求，使用67/UDP.

DHCP运行分为四个基本过程：
1. 请求IP租约
2. 提供IP租约
3. 选择IP租约
4. 确认IP租约

客户在获得了一个IP地址以后，就可以发送一个ARP请求来避免由于DHCP服务器地址池重叠而引发的IP冲突。

## DHCP DISCOVER

DHCP客户端首次登录网络时进行DHCP交互过程发送的第一个报文，用来寻找DHCP服务器。

## DHCP OFFER

DHCP服务器用来响应DHCP DISCOVER报文，此报文携带了各种配置信息。

## DHCP REQUEST

此报文用于以下三种用途。

1. 客户端初始化后，发送广播的DHCP REQUEST报文来回应服务器的DHCP OFFER报文。
2. 客户端重启后，发送广播的DHCP REQUEST报文来确认先前被分配的IP地址等配置信息。
3. 当客户端已经和某个IP地址绑定后，发送DHCP REQUEST单播或广播报文来更新IP地址的租约。

## DHCP ACK

服务器对客户端的DHCP REQUEST报文的确认响应报文，客户端收到此报文后，才真正获得了IP地址和相关的配置信息。

## DHCP NAK

服务器对客户端的DHCP REQUEST报文的拒绝响应报文，例如DHCP服务器收到DHCP REQUEST报文后，没有找到相应的租约记录，则发送DHCP NAK报文作为应答，告知DHCP客户端无法分配合适IP地址。

## DHCP DECLINE

当客户端发现服务器分配给它的IP地址发生冲突时会通过发送此报文来通知服务器，并且会重新向服务器申请地址。

## DHCP RELEASE

客户端可通过发送此报文主动释放服务器分配给它的IP地址，当服务器收到此报文后，可将这个IP地址分配给其它的客户端。

## DHCP INFORM

DHCP客户端获取IP地址后，如果需要向DHCP服务器获取更为详细的配置信息（网关地址、DNS服务器地址），则向DHCP服务器发送DHCP INFORM请求报文。
  
## 题目

### 1. 2018下半年架构师
![题目1](./imgs/ex-2018-2_14.png)

答案：C

解析： 要实现IP查域名，根据DNS中QType的相关知识，需要配置PTR记录。所以答案为 C。

![题目2](./imgs/ex-2018-2_15.png)

答案：C

解析： DHCP Decline 报文是客户端用来通知服务端分配给它的IP无效的报文。
